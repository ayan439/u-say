try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b82359af-6ec1-466b-af3d-cc6457e6003f",e._sentryDebugIdIdentifier="sentry-dbid-b82359af-6ec1-466b-af3d-cc6457e6003f")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3495],{658:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var a=s(80263),n=s(26750),r=s(10508),i=s(43479),l=s(41803),o=s(60045),d=s(53239),c=s(73969),y=s(22891),u=s(23729),g=s(32144),p=s(80251),f=s(24523),b=s(93284);async function h(e){if(!e.projectRef)throw Error("projectRef is required");let{data:t,error:s}=await (0,f.yJ)("/v1/projects/{ref}/api-keys/legacy",{params:{path:{ref:e.projectRef},query:{enabled:e.enabled}}});return s&&(0,f.H4)(s),t}let x=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,g.jE)();return(0,p.n)({mutationFn:e=>h(e),async onSuccess(t,s,n){let{projectRef:r}=s;await a.invalidateQueries({queryKey:b.f.status(r)}),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?c.oR.error("Failed to ".concat(s.enabled?"re-enable":"disable"," JWT-based API keys: ").concat(e.message)):t(e,s,a)},...s})};var m=s(18563),j=s(11053),A=s(53169),v=s(80090),k=s(84512),T=s(22806),w=s(94335),_=s(64778);let I=()=>{let{ref:e}=(0,y.g)(),{data:t}=(0,k.s)(),[s,n]=(0,d.useState)(!1),[r,i]=(0,d.useState)(!1),{data:l,isSuccess:c}=(0,m.L)({projectRef:e}),{data:g}=(0,j.o)({projectRef:e}),{can:p,isSuccess:f}=(0,v.Qp)(o.aG.SECRETS_WRITE,"*"),{data:b=[],isSuccess:h}=(0,A.n)({slug:null==t?void 0:t.slug}),{enabled:x}=l||{};return c&&f&&h?(0,a.jsxs)("section",{"data-sentry-component":"ToggleLegacyApiKeysPanel","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsx)(_.A,{"data-sentry-element":"Panel","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:(0,a.jsx)(_.A.Content,{"data-sentry-element":"Panel.Content","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{className:"text-sm",children:x?"Disable legacy API keys":"Re-enabling legacy API keys"}),(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:x?"Make sure you are no longer using your legacy API keys before proceeding.":"We recommend you use the new API keys whenever possible, but re-enabling is an option."})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(u.G,{type:"default",onClick:(null==b?void 0:b.length)?()=>i(!0):()=>n(!0),disabled:!p||!x&&(null==g?void 0:g.status)==="revoked",tooltip:{content:{side:"bottom",text:p?x||(null==g?void 0:g.status)!=="revoked"?void 0:"The legacy JWT secret is revoked. Re-enabling is not possible until it is at least moved to previously used.":"You need additional permissions to enable or disable JWT-based API keys"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:l.enabled?"Disable JWT-based API keys":"Re-enable JWT-based API keys"})})]})})}),(0,a.jsx)(K,{visible:s,onClose:()=>n(!1),legacyAPIKeysStatusData:l,"data-sentry-element":"ToggleApiKeysModal","data-sentry-source-file":"ToggleLegacyApiKeys.tsx"}),(0,a.jsx)(T.Lt,{open:r,onOpenChange:e=>i(e),"data-sentry-element":"AlertDialog","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:(0,a.jsxs)(T.EO,{"data-sentry-element":"AlertDialogContent","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsxs)(T.wd,{"data-sentry-element":"AlertDialogHeader","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsx)(T.r7,{"data-sentry-element":"AlertDialogTitle","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Apps using Supabase may break"}),(0,a.jsx)(T.$v,{"data-sentry-element":"AlertDialogDescription","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Your project uses apps that integrate with Supabase. Disabling the legacy API keys is a brand new feature and the apps you're using may not have added support for this yet. It can cause them to stop functioning. Check before continuing."})]}),(0,a.jsxs)(T.ck,{"data-sentry-element":"AlertDialogFooter","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:[(0,a.jsx)(T.Zr,{"data-sentry-element":"AlertDialogCancel","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Cancel"}),(0,a.jsx)(T.Rx,{onClick:()=>n(!0),"data-sentry-element":"AlertDialogAction","data-sentry-source-file":"ToggleLegacyApiKeys.tsx",children:"Proceed to disable API keys"})]})]})})]}):null},K=e=>{let{visible:t,onClose:s,legacyAPIKeysStatusData:n}=e,{ref:r}=(0,y.g)(),{enabled:i}=n||{},{mutate:l,isLoading:o}=x();return(0,a.jsx)(w.A,{size:"medium",visible:t,onCancel:()=>s(),onConfirm:()=>{let e=!(null==n?void 0:n.enabled);l({projectRef:r,enabled:e},{onSuccess:()=>{c.oR.success(e?"Your anon and service_role keys have been re-enabled!":"Your anon and service_role keys have been disabled!"),s()}})},title:i?"Disable JWT-based keys":"Re-enable JWT-based keys",confirmString:i?"disable":"re-enable",confirmLabel:"Confirm to ".concat(i?"disable":"re-enable"," anon and service_role"),confirmPlaceholder:i?"disable":"re-enable",loading:o,variant:i?"destructive":"default",alert:i?{title:"Ensure legacy keys are no longer in use before disabling",description:(0,a.jsxs)("span",{className:"prose text-sm",children:["Disabling ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," keys while they are in use will cause downtime for your application. Ensure they are no longer in use before proceeding. If you have not created a publishable and at least one secret API key, some dashboard functionality may become unavailable.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-danger",children:["This disables API keys when used in the ",(0,a.jsx)("code",{children:"apikey"})," header. They remain valid as a JWT."]})]})}:{title:"Publishable and secret keys are preferred",description:(0,a.jsxs)("span",{className:"prose text-sm",children:["Re-enabling ",(0,a.jsx)("code",{children:"anon"})," and ",(0,a.jsx)("code",{children:"service_role"})," keys may be appropriate in certain cases, but using a publishable and secret key is more secure. We recommend against re-enabling legacy API keys."]})},"data-sentry-element":"TextConfirmModal","data-sentry-component":"ToggleApiKeysModal","data-sentry-source-file":"ToggleLegacyApiKeys.tsx"})};var P=s(2657);let L=()=>{let{projectSettingsShowDisableLegacyApiKeys:e}=(0,P.x)(["project_settings:show_disable_legacy_api_keys"]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.K,{showTitle:!1,showNotice:!1,"data-sentry-element":"DisplayApiSettings","data-sentry-source-file":"index.tsx"}),e&&(0,a.jsx)(I,{})]})};L.getLayout=e=>(0,a.jsx)(r.A,{children:(0,a.jsx)(i.A,{children:(0,a.jsx)(n.A,{children:e})})});let D=L},11053:(e,t,s)=>{"use strict";s.d(t,{o:()=>l});var a=s(56947),n=s(24523),r=s(24735);async function i(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:r}=await (0,n.Jt)("/v1/projects/{ref}/config/auth/signing-keys/legacy",{params:{path:{ref:s}},signal:t});return r&&(0,n.H4)(r),a}let l=function(e){let{projectRef:t}=e,{enabled:s,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.H.legacy(t),queryFn:e=>{let{signal:s}=e;return i({projectRef:t},s)},enabled:s&&!!t,retry:!1,refetchOnWindowFocus:!1,...n})}},18563:(e,t,s)=>{"use strict";s.d(t,{L:()=>o});var a=s(56947),n=s(24523),r=s(85039),i=s(93284);async function l(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:a,error:r}=await (0,n.Jt)("/v1/projects/{ref}/api-keys/legacy",{params:{path:{ref:s}},signal:t});return r&&(0,n.H4)(r),a}let o=function(e){let{projectRef:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:i.f.status(t),queryFn:e=>{let{signal:s}=e;return l({projectRef:t},s)},enabled:r.pe&&s&&void 0!==t,...n})}},24735:(e,t,s)=>{"use strict";s.d(t,{H:()=>a});let a={list:e=>["projects",e,"jwt-signing-keys"],legacy:e=>["projects",e,"legacy-jwt-signing-key"]}},40884:(e,t,s)=>{"use strict";s.d(t,{R:()=>a});let a={oauthApps:e=>[e,"oauth-apps"],authorizedApps:e=>[e,"authorized-apps"]}},53169:(e,t,s)=>{"use strict";s.d(t,{n:()=>l});var a=s(56947),n=s(24523),r=s(40884);async function i(e,t){let{slug:s}=e;if(!s)throw Error("Organization slug is required");let{data:a,error:r}=await (0,n.Jt)("/platform/organizations/{slug}/oauth/apps",{params:{path:{slug:s},query:{type:"authorized"}}});return r&&(0,n.H4)(r),a}let l=function(e){let{slug:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)({queryKey:r.R.authorizedApps(t),queryFn:e=>{let{signal:s}=e;return i({slug:t},s)},enabled:s&&void 0!==t,...n})}},95059:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/settings/api-keys",function(){return s(658)}])}},e=>{e.O(0,[60858,15599,16110,44952,36538,43833,76984,72391,74004,40545,596,10508,48340,75187,29471,8750,72544,90636,46593,38792],()=>e(e.s=95059)),_N_E=e.O()}]);