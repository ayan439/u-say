try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7c24861c-2ce2-4102-9e04-ead2c4774b33",e._sentryDebugIdIdentifier="sentry-dbid-7c24861c-2ce2-4102-9e04-ead2c4774b33")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13028],{23034:(e,t,a)=>{a.d(t,{k:()=>c});var r=a(56947),n=a(24523),s=a(9620),l=a(85039),i=a(80658);async function o(e,t){let{projectRef:a}=e;if(!a)throw Error("projectRef is required");let{data:r,error:s}=await (0,n.Jt)("/platform/storage/{ref}/vector-buckets",{params:{path:{ref:a}},signal:t});return s&&(0,n.H4)(s),r}let c=function(e){let{projectRef:t}=e,{enabled:a=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:c}=(0,s.YA)(),d=(null==c?void 0:c.status)===l.BU.ACTIVE_HEALTHY;return(0,r.I)({queryKey:i.w.vectorBuckets(t),queryFn:e=>{let{signal:a}=e;return o({projectRef:t},a)},enabled:a&&void 0!==t&&d,...n})}},29556:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(80263),n=a(48510),s=a(80100),l=a(39108),i=a(62230),o=a(61767),c=a(99292);let d=e=>{let{bucketType:t,className:a}=e,d=o.TD[t];return(0,r.jsxs)("aside",{className:(0,s.cn)("border border-dashed w-full bg-surface-100 rounded-lg px-4 py-10 flex flex-col gap-y-3 items-center text-center text-balance",a),"data-sentry-component":"EmptyBucketState","data-sentry-source-file":"EmptyBucketState.tsx",children:[(0,r.jsx)(n.K7,{size:24,strokeWidth:1.5,className:"text-foreground-muted","data-sentry-element":"BucketAdd","data-sentry-source-file":"EmptyBucketState.tsx"}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsxs)("h3",{children:["Create ",d.article," ",d.singularName," bucket"]}),(0,r.jsx)("p",{className:"text-foreground-light text-sm",children:d.valueProp})]}),"files"===t&&(0,r.jsx)(i.c,{buttonSize:"tiny",buttonType:"primary",buttonClassName:"w-fit"}),"analytics"===t&&(0,r.jsx)(l.s,{buttonSize:"tiny",buttonType:"primary",buttonClassName:"w-fit"}),"vectors"===t&&(0,r.jsx)(c.G,{})]})}},39108:(e,t,a)=>{a.d(t,{s:()=>L});var r=a(80263),n=a(32981),s=a(60045),l=a(90376),i=a(80814),o=a(53239),c=a(87494),d=a(73969),u=a(19686),m=a(22891),y=a(23729),p=a(10723),f=a(78960),h=a(42018),x=a(32144),g=a(80251),b=a(24523),k=a(80658);async function j(e){let{projectRef:t,bucketName:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let{data:r,error:n}=await (0,b.bE)("/platform/storage/{ref}/analytics-buckets",{params:{path:{ref:t}},body:{bucketName:a}});return n&&(0,b.H4)(n),r}let _=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,x.jE)();return(0,g.n)({mutationFn:e=>j(e),async onSuccess(t,a,n){let{projectRef:s}=a;await r.invalidateQueries(k.w.analyticsBuckets(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?d.oR.error("Failed to create analytics bucket: ".concat(e.message)):t(e,a,r)},...a})};var v=a(3413),C=a(43964),B=a(36261),w=a(80090),M=a(84512),S=a(9620),D=a(85039),z=a(95137),A=a(80100),E=a(65887),N=a(27371),R=a(99779),T=a(44725),F=a(44053),I=a(21993),O=a(61767),P=a(84988);let q=u.Ay.object({name:u.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").refine(e=>!e.endsWith(" "),"The name of the bucket cannot end with a whitespace").refine(e=>"public"!==e,'"public" is a reserved name. Please choose another name')}).superRefine((e,t)=>{if(!I.Bt.test(e.name)){var a;let[r]=null!=(a=e.name.match(I.$P))?a:[];t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:r?'Bucket name cannot contain the "'.concat(r,'" character'):"Bucket name contains an invalid special character"})}}),V="create-analytics-storage-bucket-form",L=e=>{var t,a;let{buttonSize:u="tiny",buttonType:x="default",buttonClassName:g,disabled:b=!1,tooltip:k}=e,j=(0,i.useRouter)(),{ref:I}=(0,m.g)(),{data:L}=(0,M.s)(),{data:G}=(0,S.YA)(),{can:U}=(0,w.Qp)(s.aG.STORAGE_WRITE,"*"),{extension:W,state:H}=(0,P.P)(),[J,$]=(0,o.useState)(!1),{data:Q=[]}=(0,v.j)({projectRef:I}),Z=(0,f.mM)({projectRef:I}),K="needs-upgrade"===H,{mutate:Y}=(0,B.h)(),{mutateAsync:X,isLoading:ee}=_({onError:()=>{}}),{mutateAsync:et,isLoading:ea}=(0,C.Z)(),{mutateAsync:er,isLoading:en}=(0,h.E)(),es=O.TD.analytics,el=en||ea||ee,ei=(0,c.mN)({resolver:(0,n.u)(q),defaultValues:{name:""}}),eo=async e=>{if(!I)return console.error("Project ref is required");if(!G)return console.error("Project details is required");if(!W)return console.error("Unable to find wrappers extension");if(Q.some(t=>t.id===e.name))return d.oR.error("Bucket name already exists");try{var t,a;await X({projectRef:I,bucketName:e.name}),"not-installed"===H?(await er({projectRef:null==G?void 0:G.ref,connectionString:null==G?void 0:G.connectionString,name:W.name,schema:null!=(t=W.schema)?t:"extensions",version:W.default_version}),await et({bucketName:e.name})):"installed"===H&&await et({bucketName:e.name}),Y({action:"storage_bucket_created",properties:{bucketType:"analytics"},groups:{project:null!=I?I:"Unknown",organization:null!=(a=null==L?void 0:L.slug)?a:"Unknown"}}),ei.reset(),d.oR.success("Created bucket “".concat(e.name,"”")),$(!1),j.push("/project/".concat(I,"/storage/analytics/buckets/").concat(e.name))}catch(e){d.oR.error("Failed to create bucket: ".concat(e.message))}};return(0,r.jsxs)(z.lG,{open:J,onOpenChange:e=>{e||(ei.reset(),$(!1))},"data-sentry-element":"Dialog","data-sentry-component":"CreateAnalyticsBucketModal","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(z.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,r.jsx)(y.G,{block:!0,size:u,type:x,className:g,icon:(0,r.jsx)(l.A,{size:14}),disabled:!U||!Z||b,style:{justifyContent:"start"},onClick:()=>$(!0),tooltip:{content:{side:(null==k||null==(t=k.content)?void 0:t.side)||"bottom",className:(0,A.cn)(Z?"":"w-72 text-center"),text:Z?U?null==k||null==(a=k.content)?void 0:a.text:"You need additional permissions to create buckets":"Analytics buckets are not enabled for your project. Please contact support to enable it."}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"New bucket"})}),(0,r.jsxs)(z.Cf,{size:"large","aria-describedby":void 0,"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(z.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,r.jsxs)(z.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:["Create ",es.singularName," bucket"]})}),(0,r.jsx)(z.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx"}),(0,r.jsx)(E.lV,{...ei,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,r.jsx)("form",{id:V,onSubmit:ei.handleSubmit(eo),children:(0,r.jsxs)(z.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(E.zB,{name:"name",control:ei.control,render:e=>{let{field:t}=e;return(0,r.jsx)(F.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",description:"Must be between 3–63 characters. Only lowercase letters, numbers, dots, and hyphens are allowed.",children:(0,r.jsx)(E.MJ,{children:(0,r.jsx)(N.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx"},"name"),K?(0,r.jsx)(T.Z,{type:"warning",title:"Wrappers extension must be updated for Iceberg Wrapper support",children:(0,r.jsxs)("p",{className:"prose max-w-full text-sm !leading-normal",children:["Update the ",(0,r.jsx)("code",{className:"text-xs",children:"wrappers"})," extension by disabling and enabling it in"," ",(0,r.jsx)(p.g,{href:"/project/".concat(I,"/database/extensions?filter=wrappers"),children:"database extensions"})," ","before creating an Analytics bucket."," ",(0,r.jsx)(p.g,{href:"".concat(D.aq,"/guides/database/extensions/wrappers/iceberg"),children:"Learn more"}),"."]})}):(0,r.jsx)(T.Z,{type:"default",children:(0,r.jsxs)("p",{className:"!leading-normal",children:["Supabase will install the"," ","installed"!==H?"Wrappers extension and ":"","Iceberg Wrapper integration on your behalf."," ",(0,r.jsx)(p.g,{href:"".concat(D.aq,"/guides/database/extensions/wrappers/iceberg"),children:"Learn more"}),"."]})})]})})}),(0,r.jsxs)(z.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,r.jsx)(R.$,{type:"default",disabled:el,onClick:()=>$(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"Cancel"}),(0,r.jsx)(R.$,{form:V,htmlType:"submit",loading:el,disabled:K||el,"data-sentry-element":"Button","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"Create bucket"})]})]})]})}},42018:(e,t,a)=>{a.d(t,{E:()=>m});var r=a(72391),n=a(29395),s=a(32144),l=a(80251),i=a(73969),o=a(30659),c=a(59356),d=a(87727);async function u(e){let{projectRef:t,connectionString:a,schema:s,name:l,version:i,cascade:o=!1,createSchema:d=!1}=e,u=new Headers;a&&u.set("x-connection-encrypted",a);let{sql:m}=r.A.extensions.create({schema:s,name:l,version:i,cascade:o}),{result:y}=await (0,c.E)({projectRef:t,connectionString:a,sql:d?"create schema if not exists ".concat((0,n.bD)(s),"; ").concat(m):m,queryKey:["extension","create"]});return y}let m=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,s.jE)();return(0,l.n)({mutationFn:e=>u(e),async onSuccess(t,a,n){let{projectRef:s}=a;await Promise.all([r.invalidateQueries({queryKey:d.I.list(s)}),r.invalidateQueries({queryKey:o.n.upgradeEligibility(s)})]),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?i.oR.error("Failed to enable database extension: ".concat(e.message)):t(e,a,r)},...a})}},62230:(e,t,a)=>{a.d(t,{c:()=>O});var r=a(80263),n=a(32981),s=a(60045),l=a(90376),i=a(53239),o=a(87494),c=a(73969),d=a(19686),u=a(22891),m=a(16581),y=a(23729),p=a(10723),f=a(78960),h=a(32144),x=a(80251),g=a(24523),b=a(80658);async function k(e){let{projectRef:t,id:a,type:r,isPublic:n,file_size_limit:s,allowed_mime_types:l}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let i={id:a,type:r,public:n};"STANDARD"===r&&(s&&(i.file_size_limit=s),l&&(i.allowed_mime_types=l));let{data:o,error:c}=await (0,g.bE)("/platform/storage/{ref}/buckets",{params:{path:{ref:t}},body:i});return c&&(0,g.H4)(c),o}let j=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,h.jE)();return(0,x.n)({mutationFn:e=>k(e),async onSuccess(t,a,n){let{projectRef:s}=a;await r.invalidateQueries({queryKey:b.w.buckets(s)}),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?c.oR.error("Failed to create bucket: ".concat(e.message)):t(e,a,r)},...a})};var _=a(36261),v=a(80090),C=a(84512),B=a(85039),w=a(95137),M=a(65887),S=a(27371),D=a(72608),z=a(66329),A=a(99779),E=a(44725),N=a(44053),R=a(21993),T=a(12957);let F=d.Ay.object({name:d.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").refine(e=>!e.endsWith(" "),"The name of the bucket cannot end with a whitespace").refine(e=>"public"!==e,'"public" is a reserved name. Please choose another name'),public:d.Ay.boolean().default(!1),has_file_size_limit:d.Ay.boolean().default(!1),formatted_size_limit:d.Ay.coerce.number().min(0,"File size upload limit has to be at least 0").optional(),allowed_mime_types:d.Ay.string().trim().default("")}).superRefine((e,t)=>{if(!R.Bt.test(e.name)){var a;let[r]=null!=(a=e.name.match(R.$P))?a:[];t.addIssue({path:["name"],code:d.Ay.ZodIssueCode.custom,message:r?'Bucket name cannot contain the "'.concat(r,'" character'):"Bucket name contains an invalid special character"})}}),I="create-storage-bucket-form",O=e=>{var t;let{buttonSize:a="tiny",buttonType:d="default",buttonClassName:h,label:x="New bucket"}=e,{ref:g}=(0,u.g)(),{data:b}=(0,C.s)(),[k,R]=(0,i.useState)(!1),[O,P]=(0,i.useState)(m.s2.MB),[q,V]=(0,i.useState)(!1),{can:L}=(0,v.Qp)(s.aG.STORAGE_WRITE,"*"),{data:G}=(0,f.Ij)({projectRef:g},{enabled:B.pe}),{value:U,unit:W}=(0,T.Jb)(null!=(t=null==G?void 0:G.fileSizeLimit)?t:0),H="".concat(U," ").concat(W),{mutate:J}=(0,_.h)(),{mutateAsync:$,isLoading:Q}=j({onError:()=>{}}),Z=(0,o.mN)({resolver:(0,n.u)(F),defaultValues:{name:"",public:!1,has_file_size_limit:!1,formatted_size_limit:void 0,allowed_mime_types:""}}),{formatted_size_limit:K}=Z.formState.errors,Y=Z.watch("public"),X=Z.watch("has_file_size_limit"),ee=async e=>{var t,a;if(!g)return console.error("Project ref is required");try{let a=e.has_file_size_limit&&void 0!==e.formatted_size_limit?(0,T.OG)(e.formatted_size_limit,O):void 0,r=q&&e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):void 0;if(a&&(null==G?void 0:G.fileSizeLimit)&&a>G.fileSizeLimit)return Z.setError("formatted_size_limit",{type:"manual",message:"exceed_global_limit"});await $({projectRef:g,id:e.name,type:"STANDARD",isPublic:e.public,file_size_limit:a,allowed_mime_types:r}),J({action:"storage_bucket_created",properties:{bucketType:"STANDARD"},groups:{project:null!=g?g:"Unknown",organization:null!=(t=null==b?void 0:b.slug)?t:"Unknown"}}),c.oR.success("Successfully created bucket ".concat(e.name)),Z.reset(),P(m.s2.MB),R(!1)}catch(t){let e=(null==(a=t.message)?void 0:a.toLowerCase())||"";e.includes("mime type")&&(e.includes("is not supported")||e.includes("not supported"))?Z.setError("allowed_mime_types",{type:"manual",message:"Invalid MIME type format. Please check your input."}):c.oR.error("Failed to create bucket: ".concat(t.message))}};return(0,r.jsxs)(w.lG,{open:k,onOpenChange:e=>{e||(Z.reset(),P(m.s2.MB),R(!1))},"data-sentry-element":"Dialog","data-sentry-component":"CreateBucketModal","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(w.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(y.G,{block:!0,size:a,type:d,className:h,icon:(0,r.jsx)(l.A,{size:14}),disabled:!L,style:{justifyContent:"start"},onClick:()=>R(!0),tooltip:{content:{side:"bottom",text:L?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateBucketModal.tsx",children:x})}),(0,r.jsxs)(w.Cf,{"aria-describedby":void 0,"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(w.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(w.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateBucketModal.tsx",children:"Create file bucket"})}),(0,r.jsx)(w.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsx)(M.lV,{...Z,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsxs)("form",{id:I,onSubmit:Z.handleSubmit(ee),children:[(0,r.jsx)(w.OO,{className:"flex flex-col gap-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(M.zB,{name:"name",control:Z.control,render:e=>{let{field:t}=e;return(0,r.jsx)(N.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",children:(0,r.jsx)(M.MJ,{children:(0,r.jsx)(S.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"name")}),(0,r.jsx)(w.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsxs)(w.OO,{className:"space-y-3","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(M.zB,{name:"public",control:Z.control,render:e=>{let{field:t}=e;return(0,r.jsx)(N.M,{hideMessage:!0,name:"public",label:"Public bucket",description:"Allow anyone to read objects without authorization",layout:"flex",children:(0,r.jsx)(M.MJ,{children:(0,r.jsx)(D.d,{id:"public",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"public"),Y&&(0,r.jsx)(E.Z,{type:"warning",title:"Public buckets are not protected",description:"Users can read objects in public buckets without any authorization. Row level security (RLS) policies are still required for other operations such as object uploads and deletes."})]}),(0,r.jsx)(w.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsxs)(w.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(M.zB,{name:"has_file_size_limit",control:Z.control,render:e=>{let{field:t}=e;return(0,r.jsx)(N.M,{name:"has_file_size_limit",label:"Restrict file size",description:"Prevent uploading of files larger than a specified limit",layout:"flex",children:(0,r.jsx)(M.MJ,{children:(0,r.jsx)(D.d,{id:"has_file_size_limit",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"has_file_size_limit"),X&&(0,r.jsxs)("div",{children:[(0,r.jsx)(M.zB,{name:"formatted_size_limit",control:Z.control,render:e=>{let{field:t}=e;return(0,r.jsx)(N.M,{hideMessage:!0,name:"formatted_size_limit",label:"File size limit",children:(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-x-2",children:[(0,r.jsx)("div",{className:"col-span-8",children:(0,r.jsx)(M.MJ,{children:(0,r.jsx)(S.p,{id:"formatted_size_limit","aria-label":"File size limit",type:"number",min:0,placeholder:"0",...t})})}),(0,r.jsx)("div",{className:"col-span-4",children:(0,r.jsxs)(z.l6,{value:O,onValueChange:P,children:[(0,r.jsx)(z.bq,{"aria-label":"File size limit unit",size:"small",children:(0,r.jsx)(z.yv,{children:O})}),(0,r.jsx)(z.gC,{children:Object.values(m.s2).map(e=>(0,r.jsx)(z.eb,{value:e,className:"text-xs",children:e},e))})]})})]})})}},"formatted_size_limit"),(null==K?void 0:K.message)==="exceed_global_limit"&&(0,r.jsxs)(M.C5,{className:"mt-2",children:["Exceeds global limit of ",H,". Increase limit in"," ",(0,r.jsx)(p.g,{className:"text-destructive decoration-destructive-500 hover:decoration-destructive",href:"/project/".concat(g,"/storage/settings"),onClick:()=>R(!1),children:"Storage Settings"})," ","first."]}),B.pe&&(0,r.jsxs)("p",{className:"text-sm text-foreground-lighter mt-2",children:["This project has a"," ",(0,r.jsx)(p.g,{className:"text-foreground-light hover:text-foreground",href:"/project/".concat(g,"/storage/settings"),onClick:()=>R(!1),children:"global file size limit"})," ","of ",H,"."]})]})]}),(0,r.jsx)(w.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,r.jsxs)(w.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(N.M,{name:"has_allowed_mime_types",label:"Restrict MIME types",description:"Allow only certain types of files to be uploaded",layout:"flex","data-sentry-element":"FormItemLayout","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(M.MJ,{"data-sentry-element":"FormControl_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,r.jsx)(D.d,{id:"has_allowed_mime_types",size:"large",checked:q,onCheckedChange:V,"data-sentry-element":"Switch","data-sentry-source-file":"CreateBucketModal.tsx"})})}),q&&(0,r.jsx)(M.zB,{name:"allowed_mime_types",control:Z.control,render:e=>{let{field:t}=e;return(0,r.jsx)(N.M,{name:"allowed_mime_types",label:"Allowed MIME types",labelOptional:"Comma separated values",description:"Wildcards are allowed, e.g. image/*.",children:(0,r.jsx)(M.MJ,{children:(0,r.jsx)(S.p,{id:"allowed_mime_types",...t,placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc"})})})}},"allowed_mime_types")]})]})}),(0,r.jsxs)(w.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,r.jsx)(A.$,{type:"default",disabled:Q,onClick:()=>R(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateBucketModal.tsx",children:"Cancel"}),(0,r.jsx)(A.$,{form:I,htmlType:"submit",loading:Q,disabled:Q,"data-sentry-element":"Button","data-sentry-source-file":"CreateBucketModal.tsx",children:"Create"})]})]})]})}},87829:(e,t,a)=>{a.d(t,{D:()=>d});var r=a(80263),n=a(22891),s=a(61767),l=a(39691),i=a(41273),o=a(8750),c=a(37873);let d=e=>{var t;let{title:a,hideSubtitle:d=!1,children:u}=e,{ref:m}=(0,n.g)(),y=(0,l.kM)(),p=y&&"s3"!==y?s.TD[y]:void 0;return(0,r.jsx)(o.M,{title:a||(null!=(t=null==p?void 0:p.displayName)?t:"Storage"),subtitle:d?null:(null==p?void 0:p.description)||"Manage your storage buckets and files.",navigationItems:"files"===y?[{label:"Buckets",href:"/project/".concat(m,"/storage/files")},{label:"Settings",href:"/project/".concat(m,"/storage/files/settings")},{label:"Policies",href:"/project/".concat(m,"/storage/files/policies")}]:[],secondaryActions:(null==p?void 0:p.docsUrl)?[(0,r.jsx)(i.A,{href:p.docsUrl},"docs")]:[],"data-sentry-element":"PageLayout","data-sentry-component":"StorageBucketsLayout","data-sentry-source-file":"StorageBucketsLayout.tsx",children:(0,r.jsx)(c.eh,{className:"min-h-0","data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"StorageBucketsLayout.tsx",children:u})})}},99292:(e,t,a)=>{a.d(t,{G:()=>A});var r=a(80263),n=a(32981),s=a(60045),l=a(90376),i=a(53239),o=a(87494),c=a(73969),d=a(19686),u=a(22891),m=a(23729),y=a(32144),p=a(80251),f=a(24523),h=a(80658);async function x(e){let{projectRef:t,bucketName:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let{data:r,error:n}=await (0,f.bE)("/platform/storage/{ref}/vector-buckets",{params:{path:{ref:t}},body:{bucketName:a}});return n&&(0,f.H4)(n),r}let g=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,y.jE)();return(0,p.n)({mutationFn:e=>x(e),async onSuccess(t,a,n){let{projectRef:s}=a;await r.invalidateQueries(h.w.vectorBuckets(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?c.oR.error("Failed to create vector bucket: ".concat(e.message)):t(e,a,r)},...a})};var b=a(23034),k=a(36261),j=a(80090),_=a(84512),v=a(95137),C=a(65887),B=a(27371),w=a(99779),M=a(44053),S=a(21993);let D=d.Ay.object({name:d.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").superRefine((e,t)=>{if(!S.Bt.test(e)){var a;let[r]=null!=(a=e.match(S.$P))?a:[];t.addIssue({path:[],code:d.Ay.ZodIssueCode.custom,message:r?'Bucket name cannot contain the "'.concat(r,'" character'):"Bucket name contains an invalid special character"})}})}),z="create-storage-bucket-form",A=()=>{let{ref:e}=(0,u.g)(),{data:t}=(0,_.s)(),[a,d]=(0,i.useState)(!1),{can:y}=(0,j.Qp)(s.aG.STORAGE_WRITE,"*"),{data:p}=(0,b.k)({projectRef:e}),f=(0,o.mN)({resolver:(0,n.u)(D),defaultValues:{name:""}}),{mutate:h}=(0,k.h)(),{mutate:x,isLoading:S}=g({onSuccess:a=>{var r;h({action:"storage_bucket_created",properties:{bucketType:"vector"},groups:{project:null!=e?e:"Unknown",organization:null!=(r=null==t?void 0:t.slug)?r:"Unknown"}}),c.oR.success("Successfully created vector bucket ".concat(a.name)),f.reset(),d(!1)},onError:e=>{c.oR.error("Failed to create vector bucket: ".concat(e.message))}}),A=async t=>{var a;return e?(null!=(a=null==p?void 0:p.vectorBuckets)?a:[]).some(e=>e.vectorBucketName===t.name)?c.oR.error("Bucket name already exists"):void x({projectRef:e,bucketName:t.name}):console.error("Project ref is required")};return(0,i.useEffect)(()=>{a||f.reset()},[a]),(0,r.jsxs)(v.lG,{open:a,onOpenChange:d,"data-sentry-element":"Dialog","data-sentry-component":"CreateVectorBucketDialog","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(v.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)(m.G,{block:!0,size:"tiny",type:"primary",className:"w-fit",icon:(0,r.jsx)(l.A,{size:14}),disabled:!y,onClick:()=>d(!0),tooltip:{content:{side:"bottom",text:y?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"New bucket"})}),(0,r.jsxs)(v.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(v.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)(v.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Create vector bucket"})}),(0,r.jsx)(v.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateVectorBucketDialog.tsx"}),(0,r.jsx)(C.lV,{...f,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)("form",{id:z,onSubmit:f.handleSubmit(A),children:(0,r.jsx)(v.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,r.jsx)(C.zB,{name:"name",control:f.control,render:e=>{let{field:t}=e;return(0,r.jsx)(M.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",description:"A target schema will be created that matches this name.",children:(0,r.jsx)(C.MJ,{children:(0,r.jsx)(B.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateVectorBucketDialog.tsx"},"name")})})}),(0,r.jsxs)(v.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,r.jsx)(w.$,{type:"default",disabled:S,onClick:()=>d(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Cancel"}),(0,r.jsx)(w.$,{form:z,htmlType:"submit",loading:S,disabled:S,"data-sentry-element":"Button","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Create"})]})]})]})}}}]);