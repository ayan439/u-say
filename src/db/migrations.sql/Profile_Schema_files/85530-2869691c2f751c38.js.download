try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a825ec86-8a0c-47d6-97c7-0b0fd76823a9",e._sentryDebugIdIdentifier="sentry-dbid-a825ec86-8a0c-47d6-97c7-0b0fd76823a9")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85530],{16643:(e,t,i)=>{i.d(t,{f:()=>d});var l=i(72391),a=i(32144),n=i(80251),r=i(73969),s=i(59356),o=i(30399);async function c(e){let{projectRef:t,connectionString:i,originalPolicy:a}=e,n=new Headers;i&&n.set("x-connection-encrypted",i);let{sql:r}=l.A.policies.remove(a),{result:o}=await (0,s.E)({projectRef:t,connectionString:i,sql:r,queryKey:["policy","delete",a.id]});return o}let d=function(){let{onSuccess:e,onError:t,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,a.jE)();return(0,n.n)({mutationFn:e=>c(e),async onSuccess(t,i,a){let{projectRef:n}=i;await l.invalidateQueries({queryKey:o.S.list(n)}),await (null==e?void 0:e(t,i,a))},async onError(e,i,l){void 0===t?r.oR.error("Failed to delete database policy: ".concat(e.message)):t(e,i,l)},...i})}},50488:(e,t,i)=>{i.d(t,{l:()=>h});var l=i(80263),a=i(22891),n=i(73969),r=i(32144),s=i(80251),o=i(24523),c=i(80658);async function d(e){let{projectRef:t,id:i}=e;if(!t)throw Error("projectRef is required");if(!i)throw Error("Bucket name is requried");let{data:l,error:a}=await (0,o.bE)("/platform/storage/{ref}/buckets/{id}/empty",{params:{path:{id:i,ref:t}}});return a&&(0,o.H4)(a),l}let u=function(){let{onSuccess:e,onError:t,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,r.jE)();return(0,s.n)({mutationFn:e=>d(e),async onSuccess(t,i,a){let{projectRef:n}=i;await l.invalidateQueries({queryKey:c.w.buckets(n)}),await (null==e?void 0:e(t,i,a))},async onError(e,i,l){void 0===t?n.oR.error("Failed to empty bucket: ".concat(e.message)):t(e,i,l)},...i})};var m=i(51537),y=i(95137),f=i(99779),p=i(44725);let h=e=>{let{visible:t,bucket:i,onClose:r}=e,{ref:s}=(0,a.g)(),{fetchFolderContents:o}=(0,m.$)(),{mutate:c,isLoading:d}=u({onSuccess:async()=>{void 0!==i&&(await o({bucketId:i.id,folderId:i.id,folderName:i.name,index:-1}),n.oR.success("Successfully emptied bucket ".concat(i.name)),r())}}),h=async()=>s?i?void c({projectRef:s,id:i.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,l.jsx)(y.lG,{open:t,onOpenChange:e=>{e||r()},"data-sentry-element":"Dialog","data-sentry-component":"EmptyBucketModal","data-sentry-source-file":"EmptyBucketModal.tsx",children:(0,l.jsxs)(y.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"EmptyBucketModal.tsx",children:[(0,l.jsx)(y.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"EmptyBucketModal.tsx",children:(0,l.jsx)(y.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"EmptyBucketModal.tsx",children:"Empty bucket “".concat(null==i?void 0:i.name,"”")})}),(0,l.jsx)(y.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"EmptyBucketModal.tsx"}),(0,l.jsx)(p.Z,{type:"destructive",className:"rounded-none border-x-0 border-t-0 mb-0",title:"This action cannot be undone",description:"The contents of your bucket cannot be recovered once deleted.","data-sentry-element":"Admonition","data-sentry-source-file":"EmptyBucketModal.tsx"}),(0,l.jsx)(y.OO,{"data-sentry-element":"DialogSection","data-sentry-source-file":"EmptyBucketModal.tsx",children:(0,l.jsxs)("p",{className:"text-sm",children:["Are you sure you want to remove all contents from the bucket “",null==i?void 0:i.name,"”?"]})}),(0,l.jsxs)(y.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"EmptyBucketModal.tsx",children:[(0,l.jsx)(f.$,{type:"default",disabled:d,onClick:r,"data-sentry-element":"Button","data-sentry-source-file":"EmptyBucketModal.tsx",children:"Cancel"}),(0,l.jsx)(f.$,{type:"danger",loading:d,onClick:h,"data-sentry-element":"Button","data-sentry-source-file":"EmptyBucketModal.tsx",children:"Empty bucket"})]})]})})}},58970:(e,t,i)=>{i.d(t,{k:()=>F});var l=i(80263),a=i(32981),n=i(53239),r=i(87494),s=i(73969),o=i(10663),c=i(22891),d=i(16581),u=i(12957),m=i(10723),y=i(78960),f=i(32144),p=i(80251),h=i(24523),g=i(80658);async function x(e){let{projectRef:t,id:i,isPublic:l,file_size_limit:a,allowed_mime_types:n}=e;if(!t)throw Error("projectRef is required");if(!i)throw Error("Bucket name is requried");let r={public:l};void 0!==a&&(r.file_size_limit=a),void 0!==n&&(r.allowed_mime_types=n);let{data:s,error:o}=await (0,h.F6)("/platform/storage/{ref}/buckets/{id}",{params:{path:{id:i,ref:t}},body:r});return o?{data:null,error:o}:{data:s,error:null}}let b=function(){let{onSuccess:e,onError:t,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,f.jE)();return(0,p.n)({mutationFn:async e=>{let t=await x(e);if(t.error)throw t.error;return t.data},async onSuccess(t,i,a){let{projectRef:n}=i;await l.invalidateQueries({queryKey:g.w.buckets(n)}),await (null==e?void 0:e(t,i,a))},async onError(e,i,l){void 0===t?s.oR.error("Failed to update bucket: ".concat(e.message)):t(e,i,l)},...i})};var _=i(85039),j=i(95137),v=i(65887),k=i(27371),w=i(72608),E=i(66329),M=i(99779),z=i(44725),S=i(44053);let B=o.Ik({name:o.Yj(),public:o.zM().default(!1),has_file_size_limit:o.zM().default(!1),formatted_size_limit:o.au.number().min(0,"File size upload limit has to be at least 0").optional(),allowed_mime_types:o.Yj().trim().default("")}),C="edit-storage-bucket-form",F=e=>{var t,i,o,f,p;let{visible:h,bucket:g,onClose:x}=e,{ref:F}=(0,c.g)(),{data:D}=(0,y.Ij)({projectRef:F},{enabled:_.pe}),{value:N,unit:R}=(0,u.Jb)(null!=(i=null==D?void 0:D.fileSizeLimit)?i:0),q="".concat(N," ").concat(R),I=(0,n.useRef)(null),[O,A]=(0,n.useState)(d.s2.MB),{value:L}=(0,u.Jb)(null!=(o=null==g?void 0:g.file_size_limit)?o:0),{mutate:T,isLoading:P}=b({onSuccess:()=>{s.oR.success('Successfully updated bucket "'.concat(null==g?void 0:g.name,'"')),x()},onError:e=>{var t;let i=(null==(t=e.message)?void 0:t.toLowerCase())||"";i.includes("exceeded the maximum allowed size")||i.includes("maximum allowed size")||i.includes("entity too large")||i.includes("payload too large")?J.setError("formatted_size_limit",{type:"manual",message:"Exceeds global limit of ".concat(q,".")}):i.includes("mime type")&&(i.includes("is not supported")||i.includes("not supported"))?J.setError("allowed_mime_types",{type:"manual",message:"Invalid MIME type format. Please check your input."}):s.oR.error("Failed to update bucket: ".concat(e.message||"Unknown error"))}}),H={name:null!=(f=null==g?void 0:g.name)?f:"",public:null==g?void 0:g.public,has_file_size_limit:!!(null==g?void 0:g.file_size_limit),formatted_size_limit:(null==g?void 0:g.file_size_limit)?null!=L?L:0:void 0,allowed_mime_types:(null!=(p=null==g?void 0:g.allowed_mime_types)?p:[]).join(", ")},J=(0,r.mN)({resolver:(0,a.u)(B),defaultValues:H,values:H,mode:"onSubmit"}),{formatted_size_limit:Y}=J.formState.errors,K=J.watch("public"),$=J.watch("has_file_size_limit"),[G,Q]=(0,n.useState)(!!(null==g||null==(t=g.allowed_mime_types)?void 0:t.length)),U=(null==g?void 0:g.public)!==K,V=(null==g?void 0:g.public)&&!K,W=!(null==g?void 0:g.public)&&K,Z=()=>{J.reset(),x()},X=async e=>void 0===g?console.error("Bucket is required"):void 0===F?console.error("Project ref is required"):e.has_file_size_limit&&void 0!==e.formatted_size_limit&&(null==D?void 0:D.fileSizeLimit)&&(0,u.OG)(e.formatted_size_limit,O)>D.fileSizeLimit?J.setError("formatted_size_limit",{type:"manual",message:"exceed_global_limit"}):void T({projectRef:F,id:g.id,isPublic:e.public,file_size_limit:e.has_file_size_limit&&e.formatted_size_limit?(0,u.OG)(e.formatted_size_limit,O):null,allowed_mime_types:G&&e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):null});return(0,n.useEffect)(()=>{if(h&&g&&I.current!==g.id&&g.file_size_limit){let{unit:e}=(0,u.Jb)(g.file_size_limit);A(e),I.current=g.id}},[h,g,J]),(0,l.jsx)(j.lG,{open:h,onOpenChange:e=>{e||Z()},"data-sentry-element":"Dialog","data-sentry-component":"EditBucketModal","data-sentry-source-file":"EditBucketModal.tsx",children:(0,l.jsxs)(j.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"EditBucketModal.tsx",children:[(0,l.jsx)(j.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"EditBucketModal.tsx",children:(0,l.jsx)(j.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"EditBucketModal.tsx",children:"Edit bucket “".concat(null==g?void 0:g.name,"”")})}),(0,l.jsx)(j.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"EditBucketModal.tsx"}),(0,l.jsx)(v.lV,{...J,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"EditBucketModal.tsx",children:(0,l.jsxs)("form",{id:C,onSubmit:J.handleSubmit(X),children:[(0,l.jsxs)(j.OO,{className:"space-y-6","data-sentry-element":"DialogSection","data-sentry-source-file":"EditBucketModal.tsx",children:[(0,l.jsx)(v.zB,{name:"name",control:J.control,render:e=>{let{field:t}=e;return(0,l.jsx)(S.M,{hideMessage:!0,name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",children:(0,l.jsx)(v.MJ,{children:(0,l.jsx)(k.p,{id:"name",...t,disabled:!0})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"EditBucketModal.tsx"},"name"),(0,l.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,l.jsx)(v.zB,{name:"public",control:J.control,render:e=>{let{field:t}=e;return(0,l.jsx)(S.M,{hideMessage:!0,name:"public",label:"Public bucket",description:"Allow anyone to read objects without authorization",layout:"flex",children:(0,l.jsx)(v.MJ,{children:(0,l.jsx)(w.d,{id:"public",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"EditBucketModal.tsx"},"public"),U&&(0,l.jsx)(z.Z,{type:"warning",title:"Warning: Making bucket ".concat(W?"public":"private"),description:(0,l.jsxs)(l.Fragment,{children:[W&&(0,l.jsx)("p",{children:"This will make all objects in your bucket publicly accessible."}),V&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"mb-2 !leading-normal",children:"All objects in your bucket will only accessible via signed URLs, or downloaded with the right authorization headers."}),(0,l.jsxs)("p",{className:"!leading-normal",children:["Assets cached in the CDN may still be publicly accessible. You can consider"," ",(0,l.jsx)(m.g,{href:"".concat(_.aq,"/guides/storage/cdn/smart-cdn#cache-eviction"),children:"purging the cache"})," ","or moving your assets to a new bucket."]})]})]})})]})]}),(0,l.jsx)(j.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"EditBucketModal.tsx"}),(0,l.jsxs)(j.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"EditBucketModal.tsx",children:[(0,l.jsx)(v.zB,{name:"has_file_size_limit",control:J.control,render:e=>{let{field:t}=e;return(0,l.jsx)(S.M,{name:"has_file_size_limit",label:"Restrict file size",description:"Prevent uploading of files larger than a specified limit",layout:"flex",children:(0,l.jsx)(v.MJ,{children:(0,l.jsx)(w.d,{id:"has_file_size_limit",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"EditBucketModal.tsx"},"has_file_size_limit"),$&&(0,l.jsxs)("div",{children:[(0,l.jsx)(v.zB,{name:"formatted_size_limit",control:J.control,render:e=>{let{field:t}=e;return(0,l.jsx)(S.M,{hideMessage:!0,name:"formatted_size_limit",label:"File size limit",children:(0,l.jsxs)("div",{className:"grid grid-cols-12 gap-x-2",children:[(0,l.jsx)("div",{className:"col-span-8",children:(0,l.jsx)(v.MJ,{children:(0,l.jsx)(k.p,{id:"formatted_size_limit","aria-label":"File size limit",type:"number",min:0,placeholder:"0",...t})})}),(0,l.jsx)("div",{className:"col-span-4",children:(0,l.jsxs)(E.l6,{value:O,onValueChange:A,children:[(0,l.jsx)(E.bq,{"aria-label":"File size limit unit",size:"small",children:(0,l.jsx)(E.yv,{children:O})}),(0,l.jsx)(E.gC,{children:Object.values(d.s2).map(e=>(0,l.jsx)(E.eb,{value:e,className:"text-xs",children:e},e))})]})})]})})}},"formatted_size_limit"),(null==Y?void 0:Y.message)==="exceed_global_limit"&&(0,l.jsxs)(v.C5,{className:"mt-2",children:["Exceeds global limit of ",q,". Increase limit in"," ",(0,l.jsx)(m.g,{className:"text-destructive decoration-destructive-500 hover:decoration-destructive",href:"/project/".concat(F,"/storage/settings"),onClick:x,children:"Storage Settings"})," ","first."]}),_.pe&&(0,l.jsxs)("p",{className:"text-sm text-foreground-lighter mt-2",children:["This project has a"," ",(0,l.jsx)(m.g,{className:"text-foreground-light hover:text-foreground",href:"/project/".concat(F,"/storage/settings"),onClick:x,children:"global file size limit"})," ","of ",q,"."]})]})]}),(0,l.jsx)(j.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"EditBucketModal.tsx"}),(0,l.jsxs)(j.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"EditBucketModal.tsx",children:[(0,l.jsx)(S.M,{name:"has_allowed_mime_types",label:"Restrict MIME types",description:"Allow only certain types of files to be uploaded",layout:"flex","data-sentry-element":"FormItemLayout","data-sentry-source-file":"EditBucketModal.tsx",children:(0,l.jsx)(v.MJ,{"data-sentry-element":"FormControl_Shadcn_","data-sentry-source-file":"EditBucketModal.tsx",children:(0,l.jsx)(w.d,{id:"has_allowed_mime_types",size:"large",checked:G,onCheckedChange:Q,"data-sentry-element":"Switch","data-sentry-source-file":"EditBucketModal.tsx"})})}),G&&(0,l.jsx)(v.zB,{name:"allowed_mime_types",control:J.control,render:e=>{let{field:t}=e;return(0,l.jsx)(S.M,{name:"allowed_mime_types",label:"Allowed MIME types",labelOptional:"Comma separated values",description:"Wildcards are allowed, e.g. image/*.",children:(0,l.jsx)(v.MJ,{children:(0,l.jsx)(k.p,{id:"allowed_mime_types",...t,placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc"})})})}},"allowed_mime_types")]})]})}),(0,l.jsxs)(j.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"EditBucketModal.tsx",children:[(0,l.jsx)(M.$,{type:"default",disabled:P,onClick:Z,"data-sentry-element":"Button","data-sentry-source-file":"EditBucketModal.tsx",children:"Cancel"}),(0,l.jsx)(M.$,{form:C,htmlType:"submit",loading:P,"data-sentry-element":"Button","data-sentry-source-file":"EditBucketModal.tsx",children:"Save"})]})]})})}},62550:(e,t,i)=>{i.d(t,{j:()=>d});var l=i(56947),a=i(78510),n=i(24523),r=i(9620),s=i(85039),o=i(30399);async function c(e,t,i){let{projectRef:l,connectionString:r,schema:s}=e;if(!l)throw Error("projectRef is required");let o=new Headers(i);r&&o.set("x-connection-encrypted",r);let{data:c,error:d}=await (0,n.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":r,"x-pg-application-name":a.r},path:{ref:l},query:{included_schemas:s||"",excluded_schemas:""}},headers:o,signal:t});return d&&(0,n.H4)(d),c}let d=function(e){let{projectRef:t,connectionString:i,schema:a}=e,{enabled:n=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:u}=(0,r.YA)(),m=(null==u?void 0:u.status)===s.BU.ACTIVE_HEALTHY;return(0,l.I)({queryKey:o.S.list(t,a),queryFn:e=>{let{signal:l}=e;return c({projectRef:t,connectionString:i,schema:a},l)},enabled:n&&void 0!==t&&m,...d})}},65802:(e,t,i)=>{i.d(t,{L:()=>s});var l=i(53239),a=i(39691),n=i(62550),r=i(9620);let s=e=>{let{data:t}=(0,r.YA)(),{data:i=[],isLoading:s}=(0,n.j)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,schema:"storage"}),o=(0,l.useMemo)(()=>{let t=i.filter(e=>"objects"===e.table);return(0,a._S)(e,t).reduce((e,t)=>(e[t.name]=t.policies.length,e),{})},[e,i]);return{getPolicyCount:e=>o[e]||0,isLoading:s,policyCountMap:o}}},67203:(e,t,i)=>{i.d(t,{v:()=>k});var l=i(80263),a=i(26089),n=i.n(a),r=i(48388),s=i.n(r),o=i(80814),c=i(73969),d=i(22891),u=i(62550),m=i(16643),y=i(32144),f=i(80251),p=i(24523),h=i(80658);async function g(e){let{projectRef:t,id:i}=e;if(!t)throw Error("projectRef is required");if(!i)throw Error("Bucket name is requried");let{error:l}=await (0,p.bE)("/platform/storage/{ref}/buckets/{id}/empty",{params:{path:{ref:t,id:i}}});l&&(0,p.H4)(l);let{data:a,error:n}=await (0,p.yH)("/platform/storage/{ref}/buckets/{id}",{params:{path:{ref:t,id:i}}});return n&&(0,p.H4)(n),a}let x=function(){let{onSuccess:e,onError:t,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,y.jE)();return(0,f.n)({mutationFn:e=>g(e),async onSuccess(t,i,a){let{projectRef:n}=i;await l.invalidateQueries({queryKey:h.w.buckets(n)}),await (null==e?void 0:e(t,i,a))},async onError(e,i,l){void 0===t?c.oR.error("Failed to delete bucket: ".concat(e.message)):t(e,i,l)},...i})};var b=i(11164),_=i(9620),j=i(94335),v=i(39691);let k=e=>{let{visible:t,bucket:i,onClose:a}=e,r=(0,o.useRouter)(),{ref:y,bucketId:f}=(0,d.g)(),{data:p}=(0,_.YA)(),{data:h}=(0,b.p)({projectRef:y}),g=null!=h?h:[],{data:k}=(0,u.j)({projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString,schema:"storage"}),{mutateAsync:w,isLoading:E}=(0,m.f)(),{mutate:M,isLoading:z}=x({onSuccess:async()=>{if(!p)return console.error("Project is required");let e=(null!=k?k:[]).filter(e=>"objects"===e.table),t=(0,v._S)(g,e),l=n()(s()(t,{name:i.id}),["policies"],[]);try{await Promise.all(l.map(e=>w({projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString,originalPolicy:e}))),c.oR.success("Successfully deleted bucket ".concat(i.id)),f&&r.push("/project/".concat(y,"/storage/files")),a()}catch(e){c.oR.success("Successfully deleted bucket ".concat(i.id,". However, there was a problem deleting the policies tied to the bucket. Please review them in the storage policies section"))}}}),S=async()=>y?i?void M({projectRef:y,id:i.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,l.jsx)(j.F,{visible:t,size:"medium",variant:"destructive",title:"Delete bucket “".concat(i.id,"”"),loading:z||E,confirmPlaceholder:"Type bucket name",confirmString:i.id,confirmLabel:"Delete bucket",onCancel:a,onConfirm:S,alert:{title:"You cannot recover this bucket once deleted",description:"This action cannot be undone"},"data-sentry-element":"TextConfirmModal","data-sentry-component":"DeleteBucketModal","data-sentry-source-file":"DeleteBucketModal.tsx",children:(0,l.jsxs)("p",{className:"text-sm",children:["Your bucket ",(0,l.jsx)("span",{className:"font-bold text-foreground",children:i.id})," and all of its contents will be permanently deleted."]})})}}}]);