try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},a=(new e.Error).stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="6425be04-7dec-40f2-873d-f90f41a9d399",e._sentryDebugIdIdentifier="sentry-dbid-6425be04-7dec-40f2-873d-f90f41a9d399")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[74307],{3146:(e,a,t)=>{"use strict";t.d(a,{$:()=>n});var s=t(80263),r=t(20033),l=t(60793);let n=()=>(0,s.jsxs)(r.Fc,{variant:"default","data-sentry-element":"Alert_Shadcn_","data-sentry-component":"BackupsStorageAlert","data-sentry-source-file":"BackupsStorageAlert.tsx",children:[(0,s.jsx)(l.id,{"data-sentry-element":"WarningIcon","data-sentry-source-file":"BackupsStorageAlert.tsx"}),(0,s.jsx)(r.TN,{"data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"BackupsStorageAlert.tsx",children:"Database backups do not include objects stored via the Storage API, as the database only includes metadata about these objects. Restoring an old backup does not restore objects that have been deleted since then."})]})},11612:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>J});var s=t(80263),r=t(60045),l=t(80356),n=t(22891),o=t(53434),i=t.n(o),d=t(56718),c=t(80814),u=t(53239),f=t(73969),p=t(64778),m=t(8344),x=t(80251),h=t(24523);async function y(e){let{ref:a,backup:t}=e;if(t.isPhysicalBackup){let{data:e,error:s}=await (0,h.bE)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:a}},body:{id:t.id,recovery_time_target:t.inserted_at}});if(s)throw s;return e}let{data:s,error:r}=await (0,h.bE)("/platform/database/{ref}/backups/restore",{params:{path:{ref:a}},body:{id:t.id}});return r&&(0,h.H4)(r),s}let b=function(){let{onSuccess:e,onError:a,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,x.n)({mutationFn:e=>y(e),async onSuccess(a,t,s){await (null==e?void 0:e(a,t,s))},async onError(e,t,s){void 0===a?f.oR.error("Failed to restore from backup: ".concat(e.message)):a(e,t,s)},...t})};var g=t(86936),j=t(37115),v=t(9620),w=t(85039),k=t(68421),N=t(29948),S=t(23729),_=t(10723),B=t(24741),R=t(80090),A=t(21650),D=t(30404),I=t(88044);let T=e=>{let{index:a,isHealthy:t,backup:l,onSelectBackup:o}=e,{ref:i}=(0,n.g)(),{can:d}=(0,R.Qp)(r.aG.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:u}=(0,B.Z)({onSuccess:e=>{let{fileUrl:a}=e,t=document.createElement("a");t.href=a,document.body.appendChild(t),t.click(),document.body.removeChild(t)}});return(0,s.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(a?"border-t border-default":""),"data-sentry-component":"BackupItem","data-sentry-source-file":"BackupItem.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(I.T,{displayAs:"utc",utcTimestamp:l.inserted_at,labelFormat:"DD MMM YYYY HH:mm:ss (ZZ)",className:"text-left !text-sm font-mono tracking-tight","data-sentry-element":"TimestampInfo","data-sentry-source-file":"BackupItem.tsx"}),(0,s.jsxs)(D.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"BackupItem.tsx",children:[(0,s.jsx)(D.k$,{"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"BackupItem.tsx",children:(0,s.jsx)(A.E,{variant:"default","data-sentry-element":"Badge","data-sentry-source-file":"BackupItem.tsx",children:l.isPhysicalBackup?"Physical":"Logical"})}),(0,s.jsxs)(D.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"BackupItem.tsx",children:["Learn more about backup types"," ",(0,s.jsx)(_.g,{href:"https://supabase.com/blog/postgresql-physical-logical-backups","data-sentry-element":"InlineLink","data-sentry-source-file":"BackupItem.tsx",children:"here"})]})]})]}),(0,s.jsx)("div",{children:(e=>"COMPLETED"===e.status?(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(S.G,{type:"default",disabled:!t||!d,onClick:o,tooltip:{content:{side:"bottom",text:t?d?void 0:"You need additional permissions to trigger a restore":"Cannot be restored as project is not active"}},children:"Restore"}),(0,s.jsx)(S.G,{type:"default",icon:(0,s.jsx)(N.A,{}),loading:u,disabled:!d||u||e.isPhysicalBackup,onClick:()=>{if(!i)return console.error("Project ref is required");c({ref:i,backup:e})},tooltip:{content:{side:"bottom",className:e.isPhysicalBackup?"w-64":"",text:e.isPhysicalBackup?(0,s.jsxs)(s.Fragment,{children:["Physical backups cannot be downloaded through the dashboard. You can still download it via pgdump by following our guide"," ",(0,s.jsx)(_.g,{href:"".concat(w.aq,"/guides/troubleshooting/download-logical-backups"),children:"here"}),"."]}):d?void 0:"You need additional permissions to download backups"}},children:"Download"})]}):(0,s.jsx)(A.E,{variant:"warning","data-sentry-element":"Badge","data-sentry-component":"generateSideButtons","data-sentry-source-file":"BackupItem.tsx",children:"Backup In Progress..."}))(l)})]})};var C=t(28068),E=t(3146);let P=()=>{var e,a;let t=(0,c.useRouter)(),{ref:r}=(0,n.g)(),[l,o]=(0,u.useState)(),{setProjectStatus:x}=(0,j.l1)(),{data:h}=(0,v.YA)(),y=(null==h?void 0:h.status)===w.BU.ACTIVE_HEALTHY,{data:N}=(0,g.h)({projectRef:r}),{mutate:S,isLoading:_,isSuccess:B}=b({onSuccess:()=>{r&&setTimeout(()=>{x({ref:r,status:w.BU.RESTORING}),f.oR.success("Restoring database back to ".concat(i()(null==l?void 0:l.inserted_at).format("DD MMM YYYY HH:mm:ss"))),t.push("/project/".concat(r))},3e3)}}),R=null!=(e=null==N?void 0:N.tierKey)?e:"",A=(null!=(a=null==N?void 0:N.backups)?a:[]).sort((e,a)=>new Date(a.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),D=null==N?void 0:N.pitr_enabled;return"FREE"===R?(0,s.jsx)(m.A,{addon:"pitr",icon:(0,s.jsx)(d.A,{size:20}),primaryText:"Free Plan does not include project backups.",secondaryText:"Upgrade to the Pro Plan for up to 7 days of scheduled backups.",source:"backups"}):D?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"space-y-6",children:0===A.length&&"FREE"!==R?(0,s.jsx)(C.V,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.$,{}),(0,s.jsx)(p.A,{children:null==A?void 0:A.map((e,a)=>(0,s.jsx)(T,{backup:e,index:a,isHealthy:y,onSelectBackup:()=>o(e)},e.id))})]})}),(0,s.jsx)(k.A,{size:"medium",confirmLabel:"Confirm restore",confirmLabelLoading:"Restoring",visible:void 0!==l,title:"Confirm to restore from backup",alert:{base:{variant:"warning"},title:"Your project will be offline while the restore is in progress",description:"It is advised to upgrade at a time when there will be minimal impact for your application."},loading:_||B,onCancel:()=>o(void 0),onConfirm:()=>void 0===r?console.error("Project ref required"):void 0===l?console.error("Backup required"):void S({ref:r,backup:l}),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"BackupsList.tsx",children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to restore from"," ",i()(null==l?void 0:l.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})]})};var Y=t(61431),F=t(68296),L=t(10508),H=t(37873),M=t(44168),q=t(41273),G=t(91205),O=t(57125),V=t(39624),Z=t(53931),U=t(44725);let X=()=>{let{ref:e}=(0,n.g)(),{data:a,error:t,isLoading:o,isError:i,isSuccess:d}=(0,g.h)({projectRef:e}),c=(0,v.CG)(),u=null==a?void 0:a.pitr_enabled,{can:f,isSuccess:p}=(0,R.Qp)(r.aG.READ,"back_ups");return(0,s.jsx)(H.eh,{"data-sentry-element":"ScaffoldContainer","data-sentry-component":"DatabaseScheduledBackups","data-sentry-source-file":"scheduled.tsx",children:(0,s.jsx)(H.gu,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"scheduled.tsx",children:(0,s.jsx)("div",{className:"col-span-12",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(G.M,{className:"!mb-0",title:"Database Backups","data-sentry-element":"FormHeader","data-sentry-source-file":"scheduled.tsx"}),(0,s.jsx)(Y.A,{active:"scheduled","data-sentry-element":"DatabaseBackupsNav","data-sentry-source-file":"scheduled.tsx"}),c?(0,s.jsx)(U.Z,{type:"default",title:"Database backups are not available for OrioleDB",description:"OrioleDB is currently in public alpha and projects created are strictly ephemeral with no database backups",children:(0,s.jsx)(q.A,{abbrev:!1,className:"mt-2",href:"".concat(w.aq)})}):(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[o&&(0,s.jsx)(Z.yV,{}),i&&(0,s.jsx)(M.A,{error:t,subject:"Failed to retrieve scheduled backups"}),d&&(0,s.jsxs)(s.Fragment,{children:[!u&&(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Projects are backed up daily around midnight of your project's region and can be restored at any time."}),u&&(0,s.jsx)(O.A,{hideCollapse:!0,defaultVisibility:!0,icon:(0,s.jsx)(l.A,{strokeWidth:2}),title:"Point-In-Time-Recovery (PITR) enabled",description:(0,s.jsxs)("div",{children:["Your project uses PITR and full daily backups are no longer taken. They're not needed, as PITR supports a superset of functionality, in terms of the granular recovery that can be performed."," ",(0,s.jsx)("a",{className:"text-brand transition-colors hover:text-brand-600",href:"".concat(w.aq,"/guides/platform/backups"),children:"Learn more"})]})}),p&&!f?(0,s.jsx)(V.A,{resourceText:"view scheduled backups"}):(0,s.jsx)(P,{})]})]})]})})})})};X.getLayout=e=>(0,s.jsx)(L.A,{children:(0,s.jsx)(F.A,{title:"Database",children:e})});let J=X},37873:(e,a,t)=>{"use strict";t.d(a,{BS:()=>o,Dm:()=>c,HJ:()=>g,Rf:()=>y,Uw:()=>d,Vw:()=>w,Xr:()=>v,aw:()=>x,bV:()=>n,cJ:()=>p,dX:()=>u,eh:()=>i,fh:()=>j,gu:()=>f,sZ:()=>m,tn:()=>b,xp:()=>h});var s=t(80263),r=t(53239),l=t(80100);let n="mx-auto w-full max-w-[1200px]",o="px-4 @lg:px-6 @xl:px-10",i=(0,r.forwardRef)((e,a)=>{let{className:t,bottomPadding:r,size:n="default",...i}=e;return(0,s.jsx)("div",{ref:a,...i,className:(0,l.cn)("mx-auto w-full @container",{small:"max-w-[768px]",default:"max-w-[1200px]",large:"max-w-[1600px]",full:"max-w-none"}[n],o,r&&"pb-16",t)})}),d=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("header",{...r,ref:a,className:(0,l.cn)("w-full","flex-col gap-3 py-6",t)})}),c=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h1",{ref:a,...r,className:(0,l.cn)(t)})}),u=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("p",{ref:a,...r,className:(0,l.cn)("text-sm text-foreground-light",t)})}),f=(0,r.forwardRef)((e,a)=>{let{className:t,isFullWidth:r,topPadding:n,...o}=e;return(0,s.jsx)("div",{ref:a,...o,className:(0,l.cn)("flex flex-col first:pt-12 py-6",r?"w-full":"gap-3 @md:grid-cols-12 @lg:grid",t)})}),p=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)("w-full h-px bg-border",t)})}),m=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h3",{ref:a,...r,className:(0,l.cn)("text-foreground text-xl",t)})}),x=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("p",{ref:a,...r,className:(0,l.cn)("text-sm text-foreground-light",t)})}),h=(0,r.forwardRef)((e,a)=>{let{className:t,children:r,title:n,...o}=e;return(0,s.jsxs)("div",{ref:a,...o,className:(0,l.cn)("col-span-4 xl:col-span-5 prose text-sm",t),children:[n&&(0,s.jsx)("h2",{children:n}),r]})}),y=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)("col-span-8 xl:col-span-7","flex flex-col gap-6",t)})}),b=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)("flex flex-col gap-3 items-center",t)})}),g=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)("flex w-full items-center",t)})}),j=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)("flex flex-row gap-3",t)})}),v=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)("flex flex-col gap-3","min-w-[420px]",t)})}),w=(0,r.forwardRef)((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,...r,className:(0,l.cn)(n,o,"my-8 flex flex-col gap-8",t)})});d.displayName="ScaffoldHeader",c.displayName="ScaffoldTitle",u.displayName="ScaffoldDescription",i.displayName="ScaffoldContainer",p.displayName="ScaffoldDivider",f.displayName="ScaffoldSection",v.displayName="ScaffoldColumn",h.displayName="ScaffoldSectionDetail",y.displayName="ScaffoldSectionContent",b.displayName="ScaffoldFilterAndContent",g.displayName="ScaffoldActionsContainer",j.displayName="ScaffoldActionsGroup",w.displayName="ScaffoldContainerLegacy",m.displayName="ScaffoldSectionTitle",x.displayName="ScaffoldSectionDescription"},39859:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/backups/scheduled",function(){return t(11612)}])},86936:(e,a,t)=>{"use strict";t.d(a,{h:()=>i});var s=t(56947),r=t(24523),l=t(9620),n=t(32510);async function o(e,a){let{projectRef:t}=e;if(!t)throw Error("Project ref is required");let{data:s,error:l}=await (0,r.Jt)("/platform/database/{ref}/backups",{params:{path:{ref:t}},signal:a});return l&&(0,r.H4)(l),s}let i=function(e){let{projectRef:a}=e,{enabled:t=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,l.CG)();return(0,s.I)({queryKey:n.c.backups(a),queryFn:e=>{let{signal:t}=e;return o({projectRef:a},t)},enabled:t&&!i&&void 0!==a,...r})}}},e=>{e.O(0,[60858,15599,16110,44952,36538,43833,76984,72391,74004,40545,596,10508,48340,75187,29471,44641,90636,46593,38792],()=>e(e.s=39859)),_N_E=e.O()}]);